---
import Layout from '../layouts/Layout.astro';
import Card from '../components/Card.astro';
---

<Layout title="Welcome to Astro.">
	<html lang="es">
		<head>
			<meta charset="UTF-8">
			<meta name="viewport" content="width=device-width, initial-scale=1.0">
			<title>IP Data Searcher</title>
		</head>
		
		<body>
			<h1 class="text-white font-bold text-6xl text-center p-20">IP DATA SEARCHER</h1>
		
			<main class="mx-auto items-center text-center ">
					<form id="form" class="text-white">

						<label class="">
							IP:
							<input class="text-black" required id="input" type="text" 
							placeholder="Introduce la IP">
							<small class="grid">Por ejemplo: 54.192.189.0</small>
						</label>

			
						<button type="submit" id="submit" class="grid p-4 mx-auto bg-sky-500 font-bold 
						hover:bg-sky-700 hover:scale-110 transition-all duration-500 ">
							Buscar informaci√≥n de esta IP
						</button>
						
					</form>

				<div class="bg-white text-black">
					<pre id="results"></pre>
				</div>
			</main>
		
			<script>
				const fetchIPInfo = (ip) => {
					return fetch(`https://ip.guide/${ip}`)
						.then(response => {
							if (!response.ok) {
								throw new Error('Network response was not ok');
							}
							// Intentar parsear como JSON primero
							return response.json().catch(() => response.text());
						})
						.catch(err => console.error('Fetch error:', err));
				}
		
				const $form = document.querySelector('#form');
				const $input = document.querySelector('#input');
				const $submit = document.querySelector('#submit');
				const $results = document.querySelector('#results');
		
				$form.addEventListener('submit', async (event) => {
					event.preventDefault();
					const { value } = $input;
					if (!value) return;
		
					$submit.setAttribute('disabled', '');
					$submit.setAttribute('aria-busy', 'true');
		
					try {
						const ipInfo = await fetchIPInfo(value);
		
						if (ipInfo) {
							if (typeof ipInfo === 'string') {
								// Si la respuesta es texto
								$results.innerHTML = `<pre>${ipInfo}</pre>`;
							} else {
								// Si la respuesta es JSON
								$results.innerHTML = `<pre>${JSON.stringify(ipInfo, null, 2)}</pre>`;
							}
						}
					} catch (error) {
						$results.innerHTML = `<p>Error: ${error.message}</p>`;
					} finally {
						$submit.removeAttribute('disabled');
						$submit.removeAttribute('aria-busy');
					}
				});
			</script>
		</body>
		</html>
</Layout>
